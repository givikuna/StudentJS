<!DOCTYPE html>
<html>
    <head>
        <style>
            table {
                border-collapse: collapse;
                border: 1px solid #dddddd;
            }
            td, th {
                border: 1px solid #dddddd;
                text-align: left;
                padding: 8px;
            }
            table tr:hover {
                background-color: #00ffff8a;
            }
            table td:hover {
                background-color: #00ffff8a;
                text-emphasis-color: #00ffff8a;
            }
        </style>
        <script>

            // 8385 - studentAdd.js;
            // 8088 - selectPhone.js;
            // 8390 - studentDelete.js;
            // 8386 - studentEdit.js;
            // 8388 - select.js;
            // 8080 - index.js;
            // 8091 - indexPhone.js;
            // 8384 - image.js;

            // ---------------------------------------------------------------------------GLOBAL VARIABLES

            // All

            var xhttp = new XMLHttpRequest();

            // Users

            var tbl = document.createElement('table');
            var mainArray = [];
            var currentRow;
            var addOrEditMode;

            // Phone

            var mainPhoneArray;
            var phoneTable = document.createElement('table');

            function onStart() {
                document.getElementById("formDiv").style.display = "none";
                var url = "http://localhost:8388/?";
                xhttp.open("GET", url, true);

                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        mainArray = JSON.parse(this.responseText);
                        fillTable();
                    }
                };
                xhttp.send();
            }

            // ---------------------------------------------------------------------------USER FUNCTIONS

            // --------------FILL USER TABLE FUNCTION
            function fillTable() {
                tbl.innerHTML = "";
                for (var i = 0; i < mainArray.length; i++)  {
                    var row = document.createElement("tr");
                    for (var j = 0; j < 6; j++) {
                        var cell = document.createElement("td");
                        var cellText = "";
                        if (j == 0) {
                            cellText = mainArray[i].uid;
                            cell.innerHTML = cellText;
                        } else if (j == 1) {
                            cellText = mainArray[i].name;
                            cell.innerHTML = cellText;
                        } else if (j == 2) {
                            if (mainArray[i].morePhones == "y") {
                                cellText = "<a href=\"http://localhost:8091/?studentUid=" + mainArray[i].uid + "\">" + mainArray[i].phone + "</p>";
                                cell.innerHTML = cellText;
                            } else {
                                cellText = mainArray[i].phone;
                                cell.innerHTML = cellText;
                            }
                        }
                        if (j == 3) {
                            var image = document.createElement("img");
                            image.alt = "Image";
                            image.width = "150";
                            image.height = "100";
                            image.src = "http://localhost:8384/?img=" + mainArray[i].img;
                            cell.appendChild(image);
                        } else if (j == 4) {
                            cellText = "<button onclick=\"onClickDelete(" + i + ")\">Delete</button>";
                            cell.innerHTML = cellText;
                        } else if (j == 5) {
                            cellText = "<button onclick=\"onClickEdit(" + i + ")\">Edit</button>";
                            cell.innerHTML = cellText;
                        }
                        row.appendChild(cell);
                    }
                    tbl.appendChild(row);
                }
                document.getElementById('imageDiv').appendChild(tbl);
            }

            // --------------AFTER CLICKED ON ADD FUNCTION
            function addNew() {
                addOrEditMode = "add";
                hideShowBeforeSubmit();
            }

            // --------------AFTER CLICKED ON EDIT FUNCTION
            function onClickEdit(row) {
                addOrEditMode = "edit";
                hideShowBeforeSubmit();
                document.getElementById("nameInputId").value = mainArray[row].name;
                currentRow = row;
            }

            // --------------AFTER CLICKED ON DELETE FUNCTION
            function onClickDelete(row) {
                var url = "http://localhost:8390/?";
                var param = "number=" + mainArray[row].uid;
                xhttp.open("GET", url + param, true);
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        mainArray = JSON.parse(this.responseText);
                        fillTable();
                    }
                }
                xhttp.send();
            }

            // -------------SEND INFORMATION AFTER EDIT FUNCTION
            function sendInfoAfterEdit() {
                var newArray = mainArray[currentRow];
                newArray.name = document.getElementById("nameInputId").value;
                hideShowAfterSubmit();
                var url = "http://localhost:8386/?";
                var param = "edit=" + JSON.stringify(newArray);
                xhttp.open("GET", url + param, true);
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        mainArray = JSON.parse(this.responseText);
                        fillTable();
                    }
                }
                xhttp.send();
            }

            // -------------SEND INFORMATION AFTER ADD FUNCTION
            function sendInfoAfterAdd() {
                var newArray = {"uid":-1,"name":document.getElementById("nameInputId").value,"img":"1.jpg"};

                hideShowAfterSubmit();
                var url = "http://localhost:8385/?";
                var param = "addNew=" + JSON.stringify(newArray);
                xhttp.open("GET", url + param, true);
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        mainArray = JSON.parse(this.responseText);
                        fillTable();
                    }
                }
                xhttp.send();
            }

            // --------------AFTER CLICKED ON SUBMIT FUNCTION
            function onClickSubmitButton() {
                if (addOrEditMode == "add") {
                    sendInfoAfterAdd();
                } else {
                    sendInfoAfterEdit();
                }
            }

            // --------------HIDE OR SHOW BEFORE SUBMITTED FUNCTION
            function hideShowBeforeSubmit() {
                document.getElementById("formDiv").style.display = "block";
                document.getElementById("imageDiv").style.display = "none";
                document.getElementById("nameInputId").value = "";
            }

            // --------------HIDE OR SHOW AFTER SUBMITTED FUNCTION
            function hideShowAfterSubmit() {
                document.getElementById("formDiv").style.display = "none";
                document.getElementById("imageDiv").style.display = "block";
                document.getElementById("nameInputId").value = "";
            }
        </script>
    </head>
    <body onload="onStart()">
        <p id="error"> <!-- / --> </p>
        <div id="imageDiv">
            <button id="addButton" onclick="addNew()">Add New</button>
        </div>
        <div id="formDiv">
            <input type="text" id="nameInputId">
            <button id="afterEditButton" onclick="onClickSubmitButton()">Submit</button>
        </div>
        <div id="phoneTableDiv"> <!-- / --> </div>
    </body>
</html>

<!-- file:///home/givi/dev/StudentJS/www/index.htm -->

<!--

    [
        {
            "uid":1,
            "name":"BugzFN",
            "phone":"11",
            "img":"1.jpg",
            "morePhones":"y"
        },
        {
            "uid":2,
            "name":"ProofFN",
            "phone":"22",
            "img":"2.jpg",
            "morePhones":"y"
        },
        {
            "uid":3,
            "name":"BizarreFN",
            "phone":"33",
            "img":"3.jpg",
            "morePhones":"n"
        },
        {
            "uid":4,
            "name":"EminemFN",
            "phone":"44",
            "img":"4.jpg",
            "morePhones":"y"
        },
        {
            "uid":5,
            "name":"KunivaFN",
            "phone":"55",
            "img":"5.jpg",
            "morePhones":"n"
        },
        {
            "uid":6,
            "name":"DeaunPorterFN",
            "phone":"66",
            "img":"6.jpg",
            "morePhones":"y"
        }
    ]

-->