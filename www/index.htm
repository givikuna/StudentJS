<!DOCTYPE html>
<html>
    <head>
        <style>
            table {
                border-collapse: collapse;
                border: 1px solid #dddddd;
            }
            td, th {
                border: 1px solid #dddddd;
                text-align: left;
                padding: 8px;
            }
            table tr:hover {
                background-color: #00ffff8a;
            }
            table td:hover {
                background-color: #00ffff8a;
                text-emphasis-color: #00ffff8a;
            }
        </style>
        <script>
            var xhttp = new XMLHttpRequest();
            var tbl = document.createElement('table');
            var mainArray = [];
            var currentRow;
            var addOrEditMode;

            function onStart() {
                document.getElementById("formDiv").style.display = "none";
                document.getElementById("addFormDiv").style.display = "none";
                var url = "http://localhost:8388/?";
                xhttp.open("GET", url, true);

                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        mainArray = JSON.parse(this.responseText);
                        fillTable();
                    }
                };
                xhttp.send();
            }

            function fillTable() {
                tbl.innerHTML = "";
                for (var i = 0; i < mainArray.length; i++)  {
                    var row = document.createElement("tr");
                    for (var j = 0; j < 5; j++) {
                        var cell = document.createElement("td");
                        var cellText = "";
                        if (j == 0) {
                            cellText = mainArray[i].uid;
                            cell.innerHTML = cellText;
                        } else if (j == 1) {
                            cellText = mainArray[i].name;
                            cell.innerHTML = cellText;
                        } else if (j == 2) {
                            var image = document.createElement("img");
                            image.alt = "Image";
                            image.width = "150";
                            image.height = "100";
                            image.src = "http://localhost:8384/?img=" + mainArray[i].img;
                            cell.appendChild(image);
                        } else if (j == 3) {
                            cellText = "<button onclick=\"onClickDelete(" + i + ")\">Delete</button>";
                            cell.innerHTML = cellText;
                        } else if (j == 4) {
                            cellText = "<button onclick=\"onClickEdit(" + i + ")\">Edit</button>";
                            cell.innerHTML = cellText;
                        }
                        row.appendChild(cell);
                    }
                    tbl.appendChild(row);
                }
                document.getElementById('imageDiv').appendChild(tbl);
            }

            function addNew() {
                addOrEditMode = "add";
                hideShowBeforeSubmit();
            }

            function onClickEdit(row) {
                addOrEditMode = "edit";
                hideShowBeforeSubmit();
                document.getElementById("nameInputId").value = mainArray[row].name;
                currentRow = row;
            }

            function onClickDelete(row) {
                var url = "http://localhost:8387/?";
                var param = "number=" + mainArray[row].uid;
                xhttp.open("GET", url + param, true);
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        mainArray = JSON.parse(this.responseText);
                        fillTable();
                    }
                }
                xhttp.send();
            }

            function sendInfoAfterEdit() {
                var newArray = mainArray[currentRow];
                newArray.name = document.getElementById("nameInputId").value;
                hideShowAfterSubmit();
                var url = "http://localhost:8386/?";
                var param = "edit=" + JSON.stringify(newArray);
                xhttp.open("GET", url + param, true);
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        mainArray = JSON.parse(this.responseText);
                        fillTable();
                    }
                }
                xhttp.send();
            }

            function sendInfoAfterAdd() {
                var newArray = {"uid":-1,"name":document.getElementById("nameInputId").value,"img":"1.jpg"};

                hideShowAfterSubmit();
                var url = "http://localhost:8385/?";
                var param = "addNew=" + JSON.stringify(newArray);
                xhttp.open("GET", url + param, true);
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        mainArray = JSON.parse(this.responseText);
                        fillTable();
                    }
                }
                xhttp.send();
            }

            function onClickSubmitButton() {
                if (addOrEditMode == "add") {
                    sendInfoAfterAdd();
                } else {
                    sendInfoAfterEdit()
                }
            }

            function hideShowBeforeSubmit() {
                document.getElementById("formDiv").style.display = "block";
                document.getElementById("imageDiv").style.display = "none";
                document.getElementById("nameInputId").value = "";
            }

            function hideShowAfterSubmit() {
                document.getElementById("formDiv").style.display = "none";
                document.getElementById("imageDiv").style.display = "block";
                document.getElementById("nameInputId").value = "";
            }
        </script>
    </head>
    <body onload="onStart()">
        <p id="error"> <!-- / --> </p>
        <div id="imageDiv">
            <button id="addButton" onclick="addNew()">Add New</button>
        </div>
        <div id="formDiv">
            <input type="text" id="nameInputId">
            <button id="afterEditButton" onclick="onClickSubmitButton()">Submit</button>
        </div>
        <div id ="addFormDiv">
            <!-- / -->
        </div>
    </body>
</html>
<!-- file:///home/givi/dev/StudentJS/www/index.htm -->
